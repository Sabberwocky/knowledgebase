- open-source
- for Unix-like and Windows
- Agentless
- uses ssh

# Setup
---

## Installing on Dev-VM
Will be installed on Dev-VM, as ist pushes changed to the VPS

1. installing python & pip
```bash
sudo apt-get install python3
sudo apt-get install python3-pip
sudo apt-get install python3.10-venv
```
3. creating virtual environment with python
```bash
mkdir /home/hubadu/devops-project-01/ansible && cd $_
create_venv
```
5. installing ansible via pip
```python
pip install ansible
```

list installed packages
```python
pip freeze
```



## Shell function to create a virtual env for python
the following function will declare a funciton which creates a virtual environment in the current directory and activates it

#### create shell function
```bash
create_venv () {
   python3 -m venv venv && . venv/bin/activate && python3 -m pip install --upgrade pip &> /dev/null
}
```
- calls python module venv
- creates venv in the new direcoty
- activates it
- inside the env it will upgrade pip 
- finally it will supress any output

#### check if this funciton already exists
```bash
which create_venv
```



# Config
---

1. create ansible.cfg
```
nano ~/devops-project-01/ansible/ansible.cfg
```
   add
```
[defaults]
inventory = hosts
```
2. hosts
```
nano ~/devops-project-01/ansible/hosts
```
   add (ansible knows how to read ssh config, there we have defined devops as alias to the linde VM), here also more servers like webservers or databases could be defined (see course)
```
[main]
devops
```
3. setup.yml (this is the ansible playbook)


```
nano ~/devops-project-01/ansible/setup.yml
```
   add (roles are not related to permissions)
```
hosts: main
roles: 
```
*each role can be seen as a script in the playbook, to achieve a certain task


# Playbook
create playbook
```bash
mkdir -p hostname/tasks
cd hostname/tasks
nano main.yml
```

add the 'script' to the playbook
```python
# next task 'set hostename' sets the hostname of the VPS to 'devops.emptysoft.ch' using a built in module ansible.builtin.hostname.
# but this does not change /etc/hosts, only /ety/hostname
- name: set hostname
  ansible.builtin.hostname:
    name: devops.emptysoft.ch
    use: systemd

# the next tasks changes also /etc/hosts using ansible.builtin.linefile
# ansible.builtin.linefile opens the defined file and checks if the defiend line is in this file, if not, it adds
- name: localhost
  ansible.builtin.lineinfile:
    path: /etc/hosts
    line: 127.0.0.1 localhost.localdomain localhost

- name: devops.emptysoft.ch
  ansible.builtin.lineinfile:
    path: /etc/hosts
    line: 139.144.66.97 devops.emptysoft.ch devops-vps

```

add the 'role' (hostname) to the setup.yml as entrypoint of the 'hotname' playbook
```python
- hosts: main
  roles:
    - hostname
```


# RUN
---
ensure the python environment is active
```bash
. ~/devops-project-01/ansible/venv/bin/activate
```

run the playbook
```bash
(venv) hubadu@horizonlab-dev-udemy:~/devops-project-01/ansible$ ansible-playbook setup.yml
```

![[Pasted image 20230415212230.png]]
THIS IS HOW FUCKING SUCCESS LOOKS LIKE!!!







# ESSENTIALS

create a new more complex playbook
```bash
mkdir -p essentials/{tasks,files,handlers}
```

the following will remove the standard Linode DNS servers and only use 1.1.1.1 (cloudflare) as main DNS server.
this will be achieved by using a 'drop-in-file', which will be executed after the systemd stuff is executed, and so will overwrite the standard stuff


![[Pasted image 20230415223124.png]]

# Packages
---
	this includes several more tasks, as part of packages. makes them more granular
	[]